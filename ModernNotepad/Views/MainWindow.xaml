<Window x:Class="ModernNotepad.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:behaviors="clr-namespace:ModernNotepad.Behaviors"
        xmlns:cc="clr-namespace:ModernNotepad.CustomControls"
        xmlns:util="clr-namespace:ModernNotepad.Util"
        mc:Ignorable="d"
        Title="{Binding Title, StringFormat='\{0\} - Modern Notepad'}" 
        Height="600" Width="900"
        WindowStartupLocation="CenterScreen"
        ui:WindowHelper.UseModernWindowStyle="True"
        FocusManager.FocusedElement="{Binding ElementName=textArea}">

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Closing">
            <i:InvokeCommandAction Command="{Binding ClosingWindowCommand}" PassEventArgsToCommand="True"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <Window.InputBindings>
        <KeyBinding Command="{Binding OpenNewWindowCommand}" Gesture="Ctrl+Shift+N"/>
        <KeyBinding Command="{Binding TextEditor.CreateNewDocumentCommand}" Gesture="Ctrl+N"/>
        <KeyBinding Command="{Binding TextEditor.OpenFileCommand}" Gesture="Ctrl+A"/>
        <KeyBinding Command="{Binding TextEditor.SaveFileCommand}" Gesture="Ctrl+S"/>
        <KeyBinding Command="{Binding ShowFindReplaceWindowCommand}" Gesture="Ctrl+F"/>
        <KeyBinding Command="{Binding TextEditor.SaveFileAsCommand}" Gesture="Ctrl+Shift+S"/>        
    </Window.InputBindings>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibility"/>
        <util:BooleanToTextWrappingConverter x:Key="BooleanToTextWrapping"/>
    </Window.Resources>

    <DockPanel LastChildFill="True">
        <ui:CommandBar DockPanel.Dock="Top" DefaultLabelPosition="Right" MaxHeight="40">            
            <ui:AppBarButton Label="{DynamicResource New}" Command="{Binding TextEditor.CreateNewDocumentCommand}"
                             ToolTip="{DynamicResource NewFileToolTip}">
                <ui:AppBarButton.Icon>
                    <ui:SymbolIcon Symbol="Document"/>
                </ui:AppBarButton.Icon>
            </ui:AppBarButton>
            <ui:AppBarButton Label="{DynamicResource Open}" Command="{Binding TextEditor.OpenFileCommand}"
                             ToolTip="{DynamicResource OpenToolTip}">
                <ui:AppBarButton.Icon>
                    <ui:SymbolIcon Symbol="OpenFile"/>
                </ui:AppBarButton.Icon>
            </ui:AppBarButton>
            <ui:AppBarButton Label="{DynamicResource Save}" Command="{Binding TextEditor.SaveFileCommand}"
                             ToolTip="{DynamicResource SaveToolTip}">
                <ui:AppBarButton.Icon>
                    <ui:SymbolIcon Symbol="Save"/>
                </ui:AppBarButton.Icon>
            </ui:AppBarButton>
            <ui:AppBarButton Label="{DynamicResource Find}" Command="{Binding ShowFindReplaceWindowCommand}"
                             ToolTip="{DynamicResource FindToolTip}">
                <ui:AppBarButton.Icon>
                    <ui:SymbolIcon Symbol="Find"/>
                </ui:AppBarButton.Icon>
            </ui:AppBarButton>
            <ui:AppBarButton Label="{DynamicResource Font}" Command="{Binding ShowFontSettingsWindowCommand}"
                             ToolTip="{DynamicResource FontToolTip}">
                <ui:AppBarButton.Icon>
                    <ui:SymbolIcon Symbol="Font"/>
                </ui:AppBarButton.Icon>                
            </ui:AppBarButton>

            <ui:CommandBar.Content>
                <ui:AppBarButton Command="{Binding OpenNewWindowCommand}" ToolTip="{DynamicResource NewWindowToolTip}">
                    <ui:AppBarButton.Icon>
                        <ui:FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE109;"/>
                    </ui:AppBarButton.Icon>
                </ui:AppBarButton>
            </ui:CommandBar.Content>
            
            <ui:CommandBar.SecondaryCommands>
                <ui:AppBarButton Label="{DynamicResource SaveAs}" Command="{Binding TextEditor.SaveFileAsCommand}"/>
                <ui:AppBarSeparator/>
                <ui:AppBarToggleButton Label="{DynamicResource TextWrapping}" IsChecked="{Binding IsWordWrapEnabled}"/>
                <ui:AppBarToggleButton Label="{DynamicResource SpellCheck}" IsChecked="{Binding IsSpellCheckingEnabled}"/>
                <ui:AppBarToggleButton Label="{DynamicResource StatusBar}" IsChecked="{Binding IsStatusBarVisible}"/>
                <ui:AppBarToggleButton Label="{DynamicResource DarkTheme}"  IsChecked="{Binding IsDarkThemeEnabled}" 
                                       Command="{Binding ToggleThemeCommand}"
                                       CommandParameter="{Binding RelativeSource={RelativeSource Mode=Self}, Path=IsChecked}"/>                
                <ui:AppBarSeparator/>
                <ui:AppBarButton Label="{DynamicResource Close}" Command="{Binding CloseWindowCommand}"/>
            </ui:CommandBar.SecondaryCommands>
        </ui:CommandBar>

        <ui:CommandBar DockPanel.Dock="Bottom" MaxHeight="40" DefaultLabelPosition="Right" 
                       Visibility="{Binding IsStatusBarVisible, Converter={StaticResource BooleanToVisibility}}">
            <ui:AppBarButton Label="{DynamicResource AboutModernNotepad}" Command="{Binding ShowAboutWindowCommand}"
                             ToolTip="{DynamicResource AboutToolTip}" ToolTipService.Placement="Top">
                <ui:AppBarButton.Icon>
                    <ui:FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE946;"/>
                </ui:AppBarButton.Icon>
            </ui:AppBarButton>
            
            <ui:CommandBar.Content>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Name="lineCount" Text="{DynamicResource InitialLineCount}" Margin="10" FontSize="12"/>
                    <ui:AppBarSeparator Margin="0"/>
                    <TextBlock Name="currentLine" Text="{DynamicResource LineOne}" Margin="10" FontSize="12"/>
                    <TextBlock x:Name="currentChar" Text="{DynamicResource CharOne}" Margin="10" FontSize="12"/>
                </StackPanel>
            </ui:CommandBar.Content>
        </ui:CommandBar>

        <Popup AllowsTransparency="True" Placement="Bottom" PopupAnimation="Fade" IsOpen="{Binding ShouldPopupBeOpen}">
            <Border BorderThickness="1" CornerRadius="5" Padding="10">
                <TextBlock FontFamily="{x:Static SystemFonts.MessageFontFamily}">
                    <Run Text="{DynamicResource NoFindResults}"/>
                    <Run Text="{Binding FindReplace.TextToFind, StringFormat=' &quot;\{0\}&quot;'}"/>
                </TextBlock>
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="WhiteSmoke"/>
                        <Setter Property="BorderBrush" Value="WhiteSmoke"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsDarkThemeEnabled}" Value="True">
                                <Setter Property="Background" Value="#323232"/>
                                <Setter Property="BorderBrush" Value="#323232"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
            </Border>            
            <i:Interaction.Behaviors>
                <behaviors:PopupOpenedBehavior/>
            </i:Interaction.Behaviors>
        </Popup>

        <cc:TextArea x:Name="textArea" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto"
                     IsInactiveSelectionHighlightEnabled="True"
                     SpellCheck.IsEnabled="{Binding IsSpellCheckingEnabled}" Style="{StaticResource DefaultTextBoxStyle}"
                     TextWrapping="{Binding IsWordWrapEnabled, Converter={StaticResource BooleanToTextWrapping}}">
            <i:Interaction.Behaviors>
                <behaviors:PasteContentBehavior/>
                <behaviors:SelectionChangedBehavior CurrentLine="{Binding ElementName=currentLine, Path=Text, Mode=TwoWay}"
                                                    CurrentCharacter="{Binding ElementName=currentChar, Path=Text, Mode=TwoWay}"/>
                <behaviors:TextChangedBehavior LineCount="{Binding ElementName=lineCount, Path=Text, Mode=TwoWay}"/>
            </i:Interaction.Behaviors>                        
        </cc:TextArea>
    </DockPanel>
</Window>
